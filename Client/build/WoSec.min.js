var WoSec={baseObject:{later:function(c,d){var b=this,i=Array.prototype.slice.apply(arguments,[2]);typeof d==="string"&&(d=b[d]);setTimeout(function(){d.apply(b,i)},c);return b}},inherit:function(c,d){var b=Object.create(d.prototype);b.constructor=c;c.prototype=b},extend:function(c,d){for(var b in d)d.hasOwnProperty(b)&&(c[b]=d[b]);return c}};(function(){var c=jQuery;WoSec.SVG=function(d){this.$svg=c("#"+d)}})();
(function(){function c(c,e){return c.find("svg rect").filter(function(){return b(this).attr("bpmn:activity-id")==e})}function d(c,e){return c.find("svg circle").filter(function(){return b(this).attr("bpmn:activity-id")==e})}var b=jQuery,i={};WoSec.SVG.prototype.getTaskRectangle=function(c){i[c]||(i[c]=this.newTaskRectangle(c));return i[c]};WoSec.SVG.prototype.newTaskRectangle=function(j){var e=this.$svg,g=c(e,j);g.length||(g=d(e,j));if(g.length==0)throw Error("No rectangles/circles with activityID:["+
j+"] found");var a=Object.create(WoSec.baseObject),h=!0;a.disableAnimations=function(){h=!1;return this};a.enableAnimations=function(){h=!0;return this};a.scrollTo=function(){var k=this.getPosition(),a=k.x-e.parent().width()/2,k=k.y-e.parent().height()/2,c=e.scrollLeft(),b=e.scrollTop();if(Math.abs(a-c)>100||Math.abs(k-b)>100)e.animate({scrollLeft:a},100),e.animate({scrollTop:k},100);return this};a.refresh=function(a){switch(a.getState()){case "Reset":this.reset();break;case "Started":this.markObtrusive();
this.scrollTo();h&&this.highlight();break;case "Finished":this.markUnobtrusive(),this.scrollTo()}};a.getPosition=function(){return{x:parseInt(b(g[0]).attr("x")),y:parseInt(b(g[0]).attr("y")),width:parseInt(b(g[0]).attr("width")),height:parseInt(b(g[0]).attr("height")),getCenter:function(){return{x:this.x+this.width/2,y:this.y+this.height/2}}}};var f=e.find("svg text").filter(function(){var k=a.getPosition();return Math.abs(parseInt(b(this).attr("x"))-k.x)<k.width&&Math.abs(parseInt(b(this).attr("y"))-
k.y)<k.height});a.highlight=function(){g.each(function(){b(this).effect("pulsate",{times:3},1E3)});return this};a.markObtrusive=function(){g.each(function(){var a=b("#rect-obtrusive").css("color");b(this).attr("fill",a);b(this).css("fill",a)});return this};a.markUnobtrusive=function(){g.each(function(){var a=b("#rect-unobtrusive").css("color");b(this).attr("fill",a);b(this).css("fill",a)});return this};a.reset=function(){g.each(function(){var a=b("#rect-reset").css("color");b(this).attr("fill",a);
b(this).css("fill",a)});return this};a.registerOnClick=function(a){b(g[0]).click(a);f.each(function(){b(this).click(a)});return this};a.registerOnHover=function(a){b(g[0]).hover(a);f.each(function(){b(this).hover(a)});return this};return a}})();
(function(){function c(c,i){return c.find("svg rect").filter(function(){return d(this).attr("bpmn:pool-id")==i})}var d=jQuery;WoSec.SVG.prototype.newTaskLaneRectangle=function(b){var i=c(this.$svg,b),b=Object.create(WoSec.baseObject),j=!0;b.disableAnimations=function(){j=!1;return this};b.enableAnimations=function(){j=!0;return this};b.highlight=function(){i.each(function(){d(this).effect("pulsate",{times:1},1E3)})};b.refresh=function(){j&&this.highlight()};return b}})();
(function(){var c,d,b=jQuery;c=25.5;d=33;var i;WoSec.SVG.prototype.newDataAnimation=function(j,e,g){function a(a){a.x-=c/2;a.y-=d/2;return a}var e=a(e),g=a(g),h=Object.create(WoSec.baseObject),f=this.$svg;i||(i=document.createElementNS("http://www.w3.org/2000/svg","image"),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","media/images/fileicon.png"),i.setAttribute("width",c),i.setAttribute("height",d));var k=i.cloneNode(!0);k.setAttribute("id",j);f.find("svg")[0].appendChild(k);var l=
b("#"+j);l.hide();l.attr("x",e.x);l.attr("y",e.y);var o=!0;h.disableAnimations=function(){o=!1;return this};h.enableAnimations=function(){o=!0;return this};h.show=function(){l.show();l.animate({svgY:g.y},1E3,function(){l.hide();l.attr("y",e.y)});return this};h.refresh=function(a){switch(a.getState()){case "TransferingData":o&&this.show()}};return h}})();
(function(){var c=jQuery,d=WoSec.SVG;WoSec.HTMLGUI=function(b){var i=this,j={},e={},g={},a={},h={},f=[];this.refresh=function(k){for(var l=k.getID(),b=k.getTaskRepositoryEntries(),d,h=b.length-1;h>=0;h--)if(d=b[h],!(g[l].indexOf(d)>-1)){var f=k.getTaskByID(d),m=j[l].newTaskRectangle(d);f.registerObserver(m);var n;f.getCorrespondingTask()&&(n=j[l].newDataAnimation(d,m.getPosition().getCenter(),j[l].getTaskRectangle(f.getCorrespondingTask().getID()).getPosition().getCenter()),f.registerObserver(n));
d=i.newInfobox(m.getPosition());f.registerObserver(d);m.registerOnHover(d.show);d.appendTo(c("#"+l).find(".infoboxes"));e[l].push(m);n&&e[l].push(n)}g[l]=b;l=k.getID();b=k.getTaskLaneRepositoryEntries();for(f=b.length-1;f>=0;f--)h=b[f],a[l].indexOf(h)>-1||(m=j[l].newTaskLaneRectangle(h),k.getTaskLaneByID(h).registerObserver(m),e[l].push(m));a[l]=b;return this};b.forEach(function(a){var c=a.getWorkflow(),b=c.getID();f.push(b);h[b]=i.newTimeSlider(i,a);a.registerObserver(h[b]);c.registerObserver(i)});
c(".svg").each(function(){var b=c(this).attr("id");if(f.indexOf(b)===-1)throw Error("Unknown workflowID["+b+"]");j[b]=new d(b);e[b]=[];g[b]=[];a[b]=[]});c(".tab").each(function(){var a=c(this).attr("href").substr(1);if(f.indexOf(a)===-1)throw Error("Unknown workflowID["+a+"]");c(this).click(function(){c(".tab").each(function(){c(this).hide()});c(c(this).attr("href")).show()})});this.disableAnimations=function(){e.forEach(function(a){a.disableAnimations()});return this};this.enableAnimations=function(){e.forEach(function(a){a.enableAnimations()});
return this};c(".svg").dragscrollable({dragSelector:".dragger:first",acceptPropagatedEvent:!0})}})();
(function(){var c=jQuery,d,b,i;WoSec.HTMLGUI.prototype.newInfobox=function(j){d||(d=c("<div class=\"infobox\"><span class='infobox-pin-button'>#</span></div>").hide());var e=d.clone(),g=!0;e.css("top",j.y+j.height);e.css("left",j.x+j.width);var a=!1,h=!1;e.find(".infobox-pin-button").click(function(){h?f.unpin():f.pin()});var f=Object.create(WoSec.baseObject);return WoSec.extend(f,{refresh:function(a){this.setContent(a.getInformation())},show:function(){!a&&!g&&(e.slideToggle("slow"),a=!0,f.later(7E3,
"hide"));return this},hide:function(){a&&!h&&(e.slideToggle("slow"),a=!1);return this},pin:function(){h=!0;f.show();return this},unpin:function(){h=!1;f.hide();return this},setContent:function(a){e.find(".infobox-entry").remove();console.log(a);a.forEach(function(a){b||(b=c('<div class="infobox-entry"><span class="infobox-entry-header"><span class="infobox-entry-time"></span><span class="infobox-entry-execUser"></span></span><div class="infobox-entry-content"><span class="infobox-entry-evokUser"></span><span class="infobox-entry-provider"></span><span class="infobox-entry-data"></span><ul class="infobox-entry-attachments"></ul><span class="infobox-entry-usageReason"></span></div></div>'));
var d=b.clone(),h=new Date(a.timestamp*1E3);d.find(".infobox-entry-time").text(h.getDate()+"."+h.getMonth()+"."+h.getFullYear());a.participants&&(d.find(".infobox-entry-execUser").text(a.participants.execUser),d.find(".infobox-entry-evokUser").text(a.participants.evokUser),d.find(".infobox-entry-provider").text(a.participants.provider),g=!1);d.find(".infobox-entry-data").text(a.data);if(a.attachments){var f=d.find(".infobox-entry-attachments");a.attachments.forEach(function(a){i||(i=c('<li class="infobox-attachment-entry"><span class="infobox-attachment-entry-name"></span><a></a></li>'));
var b=i.clone();b.find(".infobox-attachment-entry-name").text(a.name);b.find("a").attr("href",a.link).text(a.type);f.append(b)});g=!1}d.find(".infobox-entry-usageReason").text(a.usageReason);e.append(d)});return this},registerOnClick:function(a){e.click(a);return this},registerOnHover:function(a,b){e.hover(a,b);return this},appendTo:function(a){e.appendTo(a);return this}})}})();
(function(){var c=jQuery,d;WoSec.HTMLGUI.prototype.newTimeSlider=function(b,i){c("#timeslider-play-button").click(function(){b.enableAnimations();i.unlock().play()});var j=[],e=c("#timeslider").slider({slide:function(c,a){var d=e.slider("option","value"),f=a.value<d,k;j.forEach(function(b){if(b.timestamp<=a.value)k=b.eventCommand});b.disableAnimations();i.lock().seek(function(a){f?a.unwind():a.execute();if(a==k)return!1},f)}});return{adjustSize:function(b){var a,h,f=e.slider("option","min"),k=e.slider("option",
"max"),l=!1;b.forEach(function(b,g){if(!j[g]){var f={};f.eventCommand=b;f.timestamp=b.getTimestamp();d||(d=c('<a class="timeslider-entry"></a>'));f.entry=d.clone().appendTo("#timeslider");f.entry.addClass("timeslider-entry-"+b.getClass());j.push(f)}f=b.getTimestamp();if(!a||f<a)a=f;if(!h||f>h)h=f;a&&(e.slider("option","min",a),l=!0);h&&(e.slider("option","max",h),l=!0)});a==f&&h==k&&(l=!1);if(l){var i=h-a;j.forEach(function(a){rightPercent=(h-a.timestamp)/i*100;a.entry.css("left",100-rightPercent+
"%")})}return this},refresh:function(b){b.getLength()!=j.length&&(this.adjustSize(b),b.isLocked()&&(c("#timeslider-play-button-overlay").show(),c("#timeslider-play-button").effect("pulsate",{times:10},1E3),setTimeout(function(){c("#timeslider-play-button-overlay").hide()},1E4)));e.slider("option","value",b.getEventCommand(b.getCurrentPosition()).getTimestamp());return this}}}})();
(function(){WoSec.MixinObservable=function(){var c=[];this.registerObserver=function(d){if(typeof d.refresh!=="function")throw Error("Observer has to support refresh()-Method");c.push(d);return this};this.notifyObservers=function(){var d=Array.prototype.slice.call(arguments);c.forEach(function(b){b.refresh.apply(b,d)});return this}}})()(function(){var c=WoSec.MixinObservable,d=["Reset","Starting","Started","Finished","TransferingData"];WoSec.newTask=function i(j,e,g){var a=Object.create(WoSec.baseObject);
c.call(a);var h="Reset",f=[];a.constructor=i;a.getID=function(){return j};a.getCorrespondingTask=function(){return typeof e=="string"&&e!=""?g.getTaskByID(e):null};a.getState=function(){return h};a.getInformation=function(){return f};a.addInformation=function(a){f.push(a);this.notifyObservers(this);return this};a.setState=function(a){if(d.indexOf(a)==-1)throw Error("Unknown state ["+a+"] given");h=a;this.notifyObservers(this);return this};return a}}());
(function(){var c=WoSec.MixinObservable;WoSec.newTaskLane=function b(i,j){var e=Object.create(WoSec.baseObject);c.call(e);var g=function(){var a=[];i.forEach(function(b,c){a[c]=j.getTaskByID(b)});return a};e.constructor=b;e.addInformation=function(a){g().forEach(function(b){b.addInformation(a)});this.notifyObservers();return this};return e}})();
(function(){var c=WoSec.newTask,d=WoSec.newTaskLane,b=WoSec.MixinObservable;WoSec.newWorkflow=function j(e,g,a){if(typeof e!="string")throw new TypeError("The given id is not a String");var h=Object.create(WoSec.baseObject),f={},k={};b.call(h);return WoSec.extend(h,{constructor:j,toString:function(){return"Workflow:"+this.getID()},getID:function(){return e},getTaskByID:function(a){if(!f[a]){var b;if(typeof a!="string")throw new TypeError("The given activityID is not a String");b=c(a,g[a],h);f[a]=
b;f[a].getCorrespondingTask();this.notifyObservers(this)}return f[a]},getTaskLaneByID:function(b){if(!k[b]){var c;if(typeof b!="string")throw new TypeError("The given groupID is not a String");if(!a[b])throw Error("Unknown activityGroupID["+b+"]");c=d(a[b],h);k[b]=c;this.notifyObservers(this)}return k[b]},getTaskRepositoryEntries:function(){var a=[],b;for(b in f)a.push(b);return a},getTaskLaneRepositoryEntries:function(){var a=[],b;for(b in k)a.push(b);return a}})}})();
(function(){function c(a){if(typeof a!="number")throw Error("Timestamp ["+a+"] is not a number");this.timestamp=a}function d(a,b,d){c.call(this,d);this.task=a;this.information=b;this.information.timestamp=d}function b(a,b,d){c.call(this,d);this.task=a;this.information=b||{};this.information.timestamp=d}function i(a,b,d){c.call(this,d);this.task=a;this.information=b||{};this.information.timestamp=d}function j(a,b,d){c.call(this,d);this.taskLane=a;this.information=b||{};this.information.timestamp=d}
var e=WoSec.newWorkflow,g;c.prototype=Object.create(WoSec.baseObject);c.prototype.classname="EventCommand";c.prototype.getClass=function(){return this.classname};c.prototype.execute=function(){return this};c.prototype.unwind=function(){return this};c.prototype.getTimestamp=function(){return this.timestamp};c.create=function(a){return new c(a.timestamp)};WoSec.inherit(d,c);d.prototype.classname="StartingTaskEvent";d.prototype.execute=function(){this.task.setState("Started");this.task.getCorrespondingTask()&&
this.task.getCorrespondingTask().setState("Started");this.task.addInformation(this.information);this.task.getCorrespondingTask()&&this.task.getCorrespondingTask().addInformation(this.information);return this};d.prototype.unwind=function(){this.task.setState("Reset");this.task.getCorrespondingTask()&&this.task.getCorrespondingTask().setState("Reset");return this};d.create=function(a){return new d(g.getTaskByID(a.activityID),a.information,a.timestamp)};WoSec.inherit(b,c);b.prototype.classname="FinishingTaskEvent";
b.prototype.execute=function(){this.task.setState("Finished");this.task.getCorrespondingTask()&&this.task.getCorrespondingTask().setState("Finished");this.task.addInformation(this.information);this.task.getCorrespondingTask()&&this.task.getCorrespondingTask().addInformation(this.information);return this};b.prototype.unwind=function(){this.task.setState("Started");this.task.getCorrespondingTask()&&this.task.getCorrespondingTask().setState("Started");return this};b.create=function(a){return new b(g.getTaskByID(a.activityID),
a.information,a.timestamp)};WoSec.inherit(i,c);i.prototype.classname="TransferingDataEvent";i.prototype.execute=function(){this.task.setState("TransferingData");this.task.addInformation(this.information);this.task.getCorrespondingTask()&&this.task.getCorrespondingTask().addInformation(this.information);return this};i.create=function(a){return new i(g.getTaskByID(a.activityID),a.information,a.timestamp)};WoSec.inherit(j,c);j.prototype.classname="SpecifyingParticipantEvent";j.prototype.execute=function(){this.taskLane.addInformation(this.information);
return this};j.create=function(a){return new j(g.getTaskLaneByID(a.activityGroupID),a.information,a.timestamp)};WoSec.eventCommands={usingWorkflow:function(a){if(!a instanceof e)throw new TypeError("Given argument is not a workflow ["+a+"]");g=a;return this},EventCommand:c,StartingTask:d,FinishingTask:b,TransferingData:i,SpecifyingParticipant:j}})();
(function(){var c=WoSec.eventCommands,d=c.EventCommand,b=WoSec.MixinObservable;WoSec.newEventChain=function j(e){var g=[],a=0,h=!1,f=Object.create(WoSec.baseObject);b.call(f);return WoSec.extend(f,{constructor:j,getWorkflow:function(){return e},getCurrentPosition:function(){return a},getEventCommand:function(a){return g[a]},getLength:function(){return g.length},lock:function(){h=!0;return this},unlock:function(){h=!1;return this},isLocked:function(){return h},add:function(a){a=a||[];a.forEach(function(a){if(!c[a.eventCommand])throw Error("Unknown EventCommand: "+
a.eventCommand);g.push(c.usingWorkflow(e)[a.eventCommand].create(a))});g.sort(function(){});this.notifyObservers(this);return this},seek:function(b,c){var d=c?-1:1,e=a;for(e==g.length&&e--;0<=e&&e<g.length;){a=e;if(b(g[e],e)===!1)break;e+=d}this.notifyObservers(this);return this},forEach:g.forEach.bind(g),play:function(){if(h)return this;var b=0;this.seek(function(a){a.later(b,"execute");b+=600});setTimeout(function(){a=g.length},b);return this},last:function(){return g[g.length-1]?g[g.length-1]:
new d(0)}})}})();
WoSec.AJAXUpdater=function(c){(function(c,b,i){i([{timestamp:1314373858,eventCommand:"FinishingTask",information:{},eventType:"humanActivityExecuted",activityID:"__fX4gedbEd-f6JWMxJDGcQ"},{timestamp:1314373863,eventCommand:"FinishingTask",information:{},eventType:"eventActivityExecuted",activityID:"_ggEwYYBxEd-3VeNHLWdQXA"},{timestamp:1314373864,eventCommand:"SpecifyingParticipant",information:{},eventType:"HumanTaskExecutorSelected",activityGroupID:"_7kTKEOdbEd-f6JWMxJDGcQ"},{timestamp:1314373864,eventCommand:"SpecifyingParticipant",
information:{participants:{provider:"DB01"}},eventType:"WSProviderSelected",activityGroupID:"_1UFV4ItpEd-U-Z7QjvIBEA"},{timestamp:1314373865,eventCommand:"TransferingData",information:{data:"Name, Adresse",participants:{provider:"DB01",evokUser:"Alice",execUser:"Ich"},attachments:[{link:"http://somewhereIbelong",name:"Das ist ein Anhang!",type:"Ein Link der nirgends hinf\u00fchrt..."}],usageReason:"wie bestellt"},eventType:"DataTransferredToWS",activityID:"_P2HHwNq2Ed-AhcDaNoYiNA"},{timestamp:1314373865,
eventCommand:"StartingTask",information:{},eventType:"startActivityExecution",activityID:"_P2HHwNq2Ed-AhcDaNoYiNA"},{timestamp:1314373866,eventCommand:"TransferingData",information:{data:"",participants:{provider:"DB01"},usageReason:"an die Datenbank geschickt, weil deshalb",attachments:[{link:"http://blabla",name:"Anschreiben",type:"Word-Dokument"},{link:"http://blablub",name:"Ausschreibung",type:"PDF-Datei"}]},eventType:"DataTransferredFromWS",activityID:"_mJVSMNq2Ed-AhcDaNoYiNA"},{timestamp:1314373867,
eventCommand:"FinishingTask",information:{participants:{provider:"DB01"}},eventType:"WSActivityExecuted",activityID:"_P2HHwNq2Ed-AhcDaNoYiNA"}])})("UpdateController?type=Event",{since:c.last().getTimestamp(),instance:c.getWorkflow().getID()},function(d){c.add(d).play()})};
